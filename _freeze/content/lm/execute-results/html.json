{
  "hash": "d2906b5c99935c737d88026fde40e891",
  "result": {
    "markdown": "---\ntitle: \"Linear Regression\"\nexecute: \n  warning: false\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\nlibrary(tidyverse)\ntheme_set(theme_bw())\n```\n:::\n\n\n## Explore Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins <- na.omit(penguins) # Remove missing value of simplicity\nhead(penguins)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-responsive\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> species </th>\n   <th style=\"text-align:left;\"> island </th>\n   <th style=\"text-align:right;\"> bill_length_mm </th>\n   <th style=\"text-align:right;\"> bill_depth_mm </th>\n   <th style=\"text-align:right;\"> flipper_length_mm </th>\n   <th style=\"text-align:right;\"> body_mass_g </th>\n   <th style=\"text-align:left;\"> sex </th>\n   <th style=\"text-align:right;\"> year </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 39.1 </td>\n   <td style=\"text-align:right;\"> 18.7 </td>\n   <td style=\"text-align:right;\"> 181 </td>\n   <td style=\"text-align:right;\"> 3750 </td>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 39.5 </td>\n   <td style=\"text-align:right;\"> 17.4 </td>\n   <td style=\"text-align:right;\"> 186 </td>\n   <td style=\"text-align:right;\"> 3800 </td>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 40.3 </td>\n   <td style=\"text-align:right;\"> 18.0 </td>\n   <td style=\"text-align:right;\"> 195 </td>\n   <td style=\"text-align:right;\"> 3250 </td>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 36.7 </td>\n   <td style=\"text-align:right;\"> 19.3 </td>\n   <td style=\"text-align:right;\"> 193 </td>\n   <td style=\"text-align:right;\"> 3450 </td>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 39.3 </td>\n   <td style=\"text-align:right;\"> 20.6 </td>\n   <td style=\"text-align:right;\"> 190 </td>\n   <td style=\"text-align:right;\"> 3650 </td>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 38.9 </td>\n   <td style=\"text-align:right;\"> 17.8 </td>\n   <td style=\"text-align:right;\"> 181 </td>\n   <td style=\"text-align:right;\"> 3625 </td>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 333\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, 36.7, 39.3, 38.9, 39.2, 41.1, 38.6…\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, 19.3, 20.6, 17.8, 19.6, 17.6, 21.2…\n$ flipper_length_mm <int> 181, 186, 195, 193, 190, 181, 195, 182, 191, 198, 18…\n$ body_mass_g       <int> 3750, 3800, 3250, 3450, 3650, 3625, 4675, 3200, 3800…\n$ sex               <fct> male, female, female, female, male, female, male, fe…\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvisdat::vis_dat(penguins)\n```\n\n::: {.cell-output-display}\n![](lm_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## Simple Linear Regression Model\n\n### Plot\n\nLet's explore a relationship between `body_mass_g` and `flipper_length_mm`. In a scatter plot ([@fig-plot-peng-scatter]), we can see that there are some kind of a linear trend.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins |> \n  ggplot(aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point(color = \"maroon\", alpha = 0.5) \n```\n\n::: {.cell-output-display}\n![Scatter plot](lm_files/figure-html/fig-plot-peng-scatter-1.png){#fig-plot-peng-scatter width=672}\n:::\n:::\n\n\n### Fit Model\n\nSimple linear regression model will be fitted to the data using:\n\n-   `body_mass_g` as a numeric outcome or dependent variable (y)\n\n-   `flipper_length_mm` as a numeric predictor or independent variable (x)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_simple_fit <- lm(body_mass_g ~ flipper_length_mm, data = penguins)\nsummary(lm_simple_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = body_mass_g ~ flipper_length_mm, data = penguins)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1057.33  -259.79   -12.24   242.97  1293.89 \n\nCoefficients:\n                  Estimate Std. Error t value Pr(>|t|)    \n(Intercept)       -5872.09     310.29  -18.93   <2e-16 ***\nflipper_length_mm    50.15       1.54   32.56   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 393.3 on 331 degrees of freedom\nMultiple R-squared:  0.7621,\tAdjusted R-squared:  0.7614 \nF-statistic:  1060 on 1 and 331 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n\n### Coefficient interpretation\n\nSince, the simple linear regression model (one predictor) is in the form of:\n\n$$\n\\hat{y} = \\hat{\\beta_0} + \\hat{\\beta_1}x\n$$\n\n-   $\\hat{\\beta_0}$ is the estimated intercept = -5780.8\n-   $\\hat{\\beta_1}$ is the estimated coefficient (slope) of the `flipper_length_mm` = 49.7\n\nAlso, the p-value of these coefficients is statistically significant ($p$ \\< 0.001), meaning the true value is very unlikely to be zero, so that we can include these values in the linear model equation.\n\nTherefore, the equation of this linear model that has been fitted to this data can be written as:\n\n$$\nbody \\ mass \\ [g] = -5780.8 + 49.7 (flipper \\  length \\ [mm])\n$$\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins |> \n  ggplot(aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point(color = \"maroon\", alpha = 0.5) +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![The fitted linear model (blue line) with confidence area (grey area) of the model's coefficient.](lm_files/figure-html/fig-plot-peng-scatter-lm-1.png){#fig-plot-peng-scatter-lm width=672}\n:::\n:::\n\n\nWe can explain this equation in simple terms as\n\n-   If the flipper length increase by 1 mm, the average increased in body mass would be 0.049 kg.\n\n\n### Model Performance\n\n\n\nR-squared ($R^2$) = 0.76\n\n-   This means that 76 % of the variation in the outcome (`body_mass_g`) can be explained by the predictor (`flipper_length_mm`) using this simple linear regression model.\n\n-   How about the other 24% of the outcome? Some is due to random error which we can't control (irreducible error) and most importantly due to reducible error which can be improve by many machine learning techniques, let's improve our linear model the next section.\n\n## Multiple Linear Regression\n\nWe will consider adding another variable `sex` in the model.\n\n### Plot\n\nFirst, let's see the distribution of `body_mass_g` in each `sex` ([@fig-plot-peng-scatter-sex]). As we can see, the `sex` also influence `body_mass_g`: the male penguins are, on average, heavier than female.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins |> \n  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = sex)) +\n  geom_point(alpha = 0.5) \n```\n\n::: {.cell-output-display}\n![Scatter plot of body mass (g) VS flipper length (mm) for each sex.](lm_files/figure-html/fig-plot-peng-scatter-sex-1.png){#fig-plot-peng-scatter-sex width=672}\n:::\n:::\n\n\n### Fit Model\n\nMultiple linear regression model will be fitted to the data using:\n\n-   **Outcome (y):** `body_mass_g` (numeric variable)\n\n-   **Predictors (x):**\n\n    -   `flipper_length_mm` (numeric variable)\n\n    -   `sex` (binary categorical variable) has 2 levels: male, female.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm_multi_fit <- lm(body_mass_g ~ flipper_length_mm + sex, data = penguins)\nsummary(lm_multi_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = body_mass_g ~ flipper_length_mm + sex, data = penguins)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-910.28 -243.89   -2.94  238.85 1067.73 \n\nCoefficients:\n                   Estimate Std. Error t value Pr(>|t|)    \n(Intercept)       -5410.300    285.798 -18.931  < 2e-16 ***\nflipper_length_mm    46.982      1.441  32.598  < 2e-16 ***\nsexmale             347.850     40.342   8.623 2.78e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 355.9 on 330 degrees of freedom\nMultiple R-squared:  0.8058,\tAdjusted R-squared:  0.8047 \nF-statistic: 684.8 on 2 and 330 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n\n### Coefficient interpretation\n\nGeneral form of multiple linear regression model with two predictors can be written as:\n\n$$\n\\hat{y} = \\hat{\\beta_0} + \\hat{\\beta_1}x_1 + \\hat{\\beta_2}x_2\n$$\n\nWhere:\n\n-   $\\hat{\\beta_0}$ is the estimated *intercept of the female* (as baseline) = -5410.3\n-   $\\hat{\\beta_1}$ is the estimated slope of both lines = 47\n-   $\\hat{\\beta_2}$ is the estimated *vertical difference* of male relative to female = 347.9\n\nThe p-value of all of the coefficients is statistically significant ($p$ \\< 0.001).\n\nTherefore, the equation of this linear model that has been fitted to this data can be written as:\n\n$$\n  body \\ mass \\ [g] = -5410.3 + 47 (flipper \\ length \\ [mm]) + 347.9 (sex) \\left\\{\n  \\begin{array}{@{}ll@{}}\n    0, & \\text{if female} \\\\\n    1, & \\text{if male}\n  \\end{array}\\right.\n$$\n\nAs in [@fig-plot-peng-scatter-lm-sex], by including categorical predictor `sex` in the model, the single line now splits into two perpendicular lines, fitted to the male and female sex.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins |> \n  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = sex)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![Multiple linear regression of body mass (g) on flipper length (mm) and sex.](lm_files/figure-html/fig-plot-peng-scatter-lm-sex-1.png){#fig-plot-peng-scatter-lm-sex width=672}\n:::\n:::\n\n\nWe can explain this equation in simple terms as:\n\n-   If the flipper length increase by 1 mm, the average increased in body mass would be 0.047 kg, in the same penguin sex.\n\n-   Male penguin is, on average, 0.35 kg heavier than female in the same flipper length.\n\n\n### Model Performance\n\nAdjusted R-squared ($R^2$) = **0.8**, increased from the previous model using simple linear regression ($R^2$ = 0.76) \n\n-   This means that 80 % of the variation in the outcome (`body_mass_g`) can be explained by the predictors (`flipper_length_mm` and `sex`) using multiple linear regression model.\n\n\n\n",
    "supporting": [
      "lm_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}